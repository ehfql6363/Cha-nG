# âš¡ 1. React(Next.js) ë¹Œë“œ ë‹¨ê³„
FROM node:18-alpine AS builder

WORKDIR /app

# package.jsonê³¼ package-lock.jsonë§Œ ë³µì‚¬ í›„ ì˜ì¡´ì„± ì„¤ì¹˜ (ìµœì í™”)
COPY package.json package-lock.json ./
RUN npm ci --production

# Next.js ì†ŒìŠ¤ ì½”ë“œ ë³µì‚¬ í›„ ë¹Œë“œ ì‹¤í–‰
COPY . .
RUN npm run build

# ğŸƒâ€â™‚ï¸ 2. ë°°í¬ìš© ì»¨í…Œì´ë„ˆ (Next.js ì„œë²„ ì‹¤í–‰)
FROM node:18-alpine

WORKDIR /app

# ë¹Œë“œëœ Next.js íŒŒì¼ê³¼ í•„ìš”í•œ íŒ¨í‚¤ì§€ë§Œ ë³µì‚¬
COPY --from=builder /app/package.json ./
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/.next ./.next
COPY --from=builder /app/public ./public

EXPOSE 3000

# Next.js í”„ë¡œë•ì…˜ ì‹¤í–‰
CMD ["npx", "next", "start"]